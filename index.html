<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>掲示板管理者ページ</title>
<style>
  body { font-family: 'Kosugi Maru', sans-serif; background-color: #f7f7f7; margin: 0; padding: 0; }
  .container { width: 100%; max-width: 800px; margin: 20px auto; padding: 10px; background-color: #fff; border-radius: 10px; border: 2px solid #ccc; }
  h1 { text-align: center; color: #ffd700; }
  .posts { margin-top: 20px; }
  .post { border-bottom: 1px solid #ddd; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
  .post-text { flex: 1; margin-left: 10px; }
  .delete-btn { background-color: #ff4d4d; border: none; color: #fff; padding: 5px 10px; cursor: pointer; border-radius: 5px; }
  .delete-btn:hover { background-color: #ff1a1a; }
</style>
</head>
<body>

<div class="container">
  <h1>掲示板管理者ページ</h1>
  <div class="posts" id="posts"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, onValue, remove, query, orderByChild } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  // Firebase設定（掲示板と同じ）
  const firebaseConfig = {
    apiKey: "AIzaSyByFru8zWFZc3Xxx3pfCGSlaXRTrhVB6b0",
    authDomain: "banpakukeijiban.firebaseapp.com",
    databaseURL: "https://banpakukeijiban-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "banpakukeijiban",
    storageBucket: "banpakukeijiban.storage.app",
    messagingSenderId: "1006590731119",
    appId: "1:1006590731119:web:a40179cc8bc5c9972efe9a"
  };

  // Firebase初期化
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const postsDiv = document.getElementById('posts');

  // 投稿のリアルタイム取得
  const postsQuery = query(ref(db, 'posts'), orderByChild('timestamp'));
  onValue(postsQuery, (snapshot) => {
    postsDiv.innerHTML = '';
    const data = snapshot.val();
    if (data) {
      const postsArray = Object.entries(data)
        .sort((a, b) => b[1].timestamp - a[1].timestamp); // 新しい順
      postsArray.forEach(([key, post]) => {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        const authorText = post.author ? `${post.author}:` : '';
        postDiv.innerHTML = `<span class="post-text"><strong>${authorText}</strong> ${post.text}</span>`;
        
        // 削除ボタン
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '削除';
        deleteBtn.className = 'delete-btn';
        deleteBtn.onclick = () => {
          if (confirm('本当に削除しますか？')) {
            remove(ref(db, 'posts/' + key));
          }
        };

        postDiv.appendChild(deleteBtn);
        postsDiv.appendChild(postDiv);
      });
    }
  });

</script>
</body>
</html>
